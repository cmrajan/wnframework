'No of Documents:1'
'Document No:0'
{'allow_attach': None,
 'allow_copy': None,
 'allow_email': None,
 'allow_print': None,
 'allow_rename': None,
 'autoname': None,
 'change_log': None,
 'client_script': '\ncur_frm.cscript.get_item_wise_tax_detail = function(doc, rate, cl, i, tax, t){\n   var doc = locals[doc.doctype][doc.name];\n   var item_wise_tax_detail = \'\'\n   if (flt(rate) != 0) {\n    var idx = cl[i].idx;\n    if (tax[t].item_wise_tax_detail == \'\') {  item_wise_tax_detail = idx.toString();  }\n    else { item_wise_tax_detail =  \',\' + idx.toString(); } \n  }\n  return item_wise_tax_detail\n}\n\ncur_frm.fields_dict[cur_frm.cscript.fname].grid.get_field("item_code").get_query = function(doc, cdt, cdn) {\n  return \'SELECT tabItem.name,tabItem.item_name FROM tabItem WHERE tabItem.is_sales_item="Yes" AND tabItem.is_active = "Yes" AND tabItem.%(key)s LIKE "%s"\'\n}\n\ncur_frm.cscript.commission_applicable = function(doc){\n  var commission_fields = [\'cash_discount_rate\',\'per_on_ref_rate_total\',\'commission_rate\',\'rate_of_dis_saving\'];\n  if (doc.commission_applicable == "Yes"){\n    for(var i = 0; i < commission_fields.length ; i++){\n      get_field(doc.doctype, commission_fields[i] , doc.name).permlevel = 0;\n    }\n  }\n  if (doc.commission_applicable == "No"){\n    for(var i = 0; i < commission_fields.length ; i++){\n      get_field(doc.doctype, commission_fields[i] , doc.name).permlevel = 1;\n    }\n  }\n  refresh_many([\'cash_discount_rate\',\'per_on_ref_rate_total\',\'commission_rate\',\'rate_of_dis_saving\']);\n}\n\ncur_frm.cscript.cash_discount_rate = function(doc){\n  var discount_rate = flt(doc.total_discount_rate) - flt(doc.cash_discount_rate);\n  var net_discount = flt(flt(doc.ref_rate_total) - (flt(doc.ref_rate_total)*(100-flt(discount_rate))/100));\n  var gross_amt = flt(doc.ref_rate_total) - flt(net_discount);\n  var cash_discount_amt = flt(flt(gross_amt) * flt(doc.cash_discount_rate)/100);\n  \n  doc.discount_rate = flt(discount_rate);\n  doc.diff_baseline_discount= flt(doc.baseline) - flt(discount_rate);\n  doc.net_discount = flt(net_discount);\n  doc.gross_amt = flt(gross_amt);\n  doc.work_order_value = flt(flt(gross_amt)- flt(cash_discount_amt));\n  doc.cash_discount_amt = flt(cash_discount_amt);\n  refresh_many([\'discount_rate\',\'gross_amt\',\'net_discount\',\'cash_discount_amt\',\'work_order_value\',\'diff_baseline_discount\']);\n  cur_frm.cscript.per_on_ref_rate_total(doc);\n}\n\ncur_frm.cscript.per_on_ref_rate_total = function(doc){\n\n  var price_list_value = flt(flt(doc.per_on_ref_rate_total) * flt(doc.ref_rate_total) / 100);\n  doc.price_list_value = flt(price_list_value);\n  refresh_many([\'price_list_value\']);\n  cur_frm.cscript.commission_rate(doc);\n}\n\ncur_frm.cscript.commission_rate = function(doc){\n\n  var commission_amt = flt(flt(doc.price_list_value) * flt(doc.commission_rate)/100);\n  var amount_for_incentive = flt(flt(doc.work_order_value) - flt(doc.price_list_value));\n  doc.commission_amt = flt(commission_amt);\n  doc.amount_for_incentive = flt(amount_for_incentive);\n  refresh_many([\'commission_amt\',\'amount_for_incentive\']);\n  cur_frm.cscript.saving_factor(doc);\n}\n\ncur_frm.cscript.saving_factor = function(doc){\n  if (flt(doc.saving_factor) >  0){\n    doc.rate_of_dis_saving = flt(doc.diff_baseline_discount)/flt(doc.saving_factor);\n    var total_incentive = flt(doc.ref_rate_total) * flt(doc.rate_of_dis_saving)/100;\n  }\n  else{ var total_incentive = 0 }\n  var total_commission_amount = flt(flt(doc.commission_amt) + flt(total_incentive));\n  doc.total_incentive = flt(total_incentive);\n  doc.total_commission_amount = flt(total_commission_amount);\n  refresh_many([\'total_incentive\',\'total_commission_amount\',\'rate_of_dis_saving\']);\n}\n\ncur_frm.cscript[\'Calculate Commission\'] = function(doc){\n  cur_frm.cscript.commission_calc(doc);\n}\n\ncur_frm.cscript.commission_calc = function(doc){\n  var doc = locals[doc.doctype][doc.name];\n    \n  cur_frm.cscript.cash_discount_rate(doc);\n  cur_frm.cscript.per_on_ref_rate_total(doc);\n  cur_frm.cscript.commission_rate(doc);\n  cur_frm.cscript.saving_factor(doc);\n}\n\ncur_frm.cscript.custom_recalc = function(doc) {\n  var doc = locals[doc.doctype][doc.name];\n  var tname = cur_frm.cscript.tname;\n  var fname = cur_frm.cscript.fname;\n  var cl = getchildren(tname, doc.name, fname);\n  var total = 0;\n  for(var i=0;i<cl.length;i++) {\n    total += flt(cl[i].qty) * flt(cl[i].ref_rate);\n  }\n  doc.ref_rate_total = flt(total);\n  doc.total_discount = flt(total) - flt(doc.net_total);\n  if (total) {\n    doc.total_discount_rate = flt((flt(total) - flt(doc.net_total)) / flt(total) * 100);\n  }\n  refresh_many([\'ref_rate_total\',\'total_discount\',\'total_discount_rate\']);\n  cur_frm.cscript.commission_calc(doc);\n  if(cur_frm.cscript.calc_excise_paid) cur_frm.cscript.calc_excise_paid(doc);\n}\n\n// *********************** QUANTITY ***************************\ncur_frm.cscript.qty = function(doc, cdt, cdn) { \n  if(cur_frm.cscript.update_income_account){\n    cur_frm.cscript.update_income_account(doc,cdt,cdn);\n  }\n  if(cur_frm.cscript.calculate_single_print_rate){\n    d = locals[cdt][cdn];\n    cur_frm.cscript.calculate_single_print_rate(doc, d, 0);\n  }\n  cur_frm.cscript.recalc(doc, 1); \n}\n\n//cur_frm.cscript.hide = function(doc,cdt,cdn){\n//  d = locals[cdt][cdn];\n//  alert(d.hide);\n//  cur_frm.cscript.calculate_print_rate_for_all(doc);\n//  alert("The End");\n//}\n\ncur_frm.cscript.calculate_print_rate_for_all = function(doc) {\n  cl = getchildren(cur_frm.cscript.tname, doc.name, cur_frm.cscript.fname, doc.doctype);\n  for(var i = 0; i<cl.length; i++){\n    cur_frm.cscript.calculate_single_print_rate(doc, cl[i], 0);\n  }\n  cur_frm.cscript.recalc(doc, 2);\n}\n\ncur_frm.cscript.calculate_single_print_rate = function(doc, d, is_single){\n  doc.excise_rate = 0;\n  doc.total_excise_rate = 0;\n  doc.sales_tax_rate = 0;\n  var hide = 0;\n  // Calculate Total Excise Rate and Sales Tax Rate \n  var tax = getchildren(\'RV Tax Detail\', doc.name, cur_frm.cscript.other_fname);\n  for (var t = 0; t < tax.length; t++){\n    if (flt(tax[t].hide) == 1) {\n      hide = 1;\n      var check_tax = eval(\'var a=\'+d.item_tax_rate+\';a\');        //to get in dictionary\n      var account = tax[t].account_head;\n\n      if(check_tax[account]!=null)  { rate = flt(check_tax[account]); }\n      else {              // if particular item doesn\'t have particular rate it will take other charges rate\n        rate = flt(tax[t].rate);}\n      cur_frm.cscript.check_charge_type_and_get_tax_amount( doc,tax, t, d, rate, print_amt = 1);\n    }\n  }\n\n  refresh_field(\'total_excise_rate\');\n  refresh_field(\'sales_tax_rate\');\n\n  // Calculate A & B\n  if (doc.total_excise_rate == 0) var A = 1;\n  else var A = (1 + (flt(doc.total_excise_rate)/100));\n  if (doc.sales_tax_rate == 0) var B = 1;\n  else var B = (1 + (flt(doc.sales_tax_rate)/100));\n\n  // check for at least one hide\n  if(flt(hide) == 0 ){\n    set_multiple(cur_frm.cscript.tname, d.name, {\'print_amt\': 0, \'print_rate\': 0 }, cur_frm.cscript.fname);\n    alert("Please check hide in Other Charges Table as per your requirement and then enter Print Rate");\n    return\n  }\n\n  // Calculate Print Amount\n  set_multiple(cur_frm.cscript.tname, d.name, {\'print_amt\': flt(d.qty) * flt(d.print_rate) }, cur_frm.cscript.fname);\n  \n  // Calculate Basic Rate \n  if(A && B) {\n      set_multiple(cur_frm.cscript.tname, d.name, {\'basic_rate\':  flt(d.print_rate) / (flt(A) * flt(B)) }, cur_frm.cscript.fname);\n  }\n  \n  if (is_single == 1){   cur_frm.cscript.recalc(doc, 2);  }\n}\n\ncur_frm.cscript.print_rate = function(doc,cdt,cdn) {\n  doc = locals[doc.doctype][doc.name];\n  var d = locals[cdt][cdn];\n  cur_frm.cscript.calculate_single_print_rate(doc, d,  1)\n}\n\n\nfunction check_it(){\n\n  var hide = 0\n  if(flt(d.print_rate) > 0){\n    var fname = cur_frm.cscript.fname;\n    var other_fname  = cur_frm.cscript.other_fname;\n    doc.excise_rate = 0;\n    doc.total_excise_rate = 0;\n    doc.sales_tax_rate = 0;\n    var tax = getchildren(\'RV Tax Detail\', doc.name, other_fname);\n    for (var t = 0; t < tax.length; t++){\n      if (flt(tax[t].hide) == 1) {\n        hide =1;\n        var check_tax = eval(\'var a=\'+d.item_tax_rate+\';a\');        //to get in dictionary\n        var account = tax[t].account_head;\n        if(check_tax[account]!=null)  { rate = flt(check_tax[account]); }\n        else {              // if particular item doesn\'t have particular rate it will take other charges rate\n        rate = flt(tax[t].rate);}\n        cur_frm.cscript.check_charge_type_and_get_tax_amount( doc,tax, t, d, rate, print_amt = 1);\n      }\n    }\n    refresh_field(\'total_excise_rate\');\n    refresh_field(\'sales_tax_rate\');\n    if (doc.total_excise_rate == 0) var A = 1;\n    else var A = (1 + (flt(doc.total_excise_rate)/100));\n    if (doc.sales_tax_rate == 0) var B = 1;\n    else var B = (1 + (flt(doc.sales_tax_rate)/100));\n    if (flt(hide) > 0) {\n      d.print_amt = flt(d.qty) * flt(d.print_rate);\n      alert(d.print_rate)\n      alert(d.print_amt)\n      refresh_field(\'print_amt\',d.name,fname);\n      if(A && B) {\n        d.basic_rate = flt(d.print_rate) / (flt(A) * flt(B));\n      }\n      refresh_field(\'basic_rate\',d.name,fname);\n      cur_frm.cscript.recalc(doc, 2);\n    }\n    if(flt(hide) == 0 ){\n      alert("Please check hide in Other Charges Table as per your requirement and then enter Print Rate");\n      d.print_rate = 0;\n      d.print_amt = 0;\n    }\n  }\n\n\n}',
 'client_script_core': '// Preset\n// ------\n// cur_frm.cscript.tname - Details table name\n// cur_frm.cscript.fname - Details fieldname\n// cur_frm.cscript.other_fname - Other Charges fieldname\n// cur_frm.cscript.sales_team_fname - Sales Team fieldname\n\n// ============== Customer and its primary contact Details ============================\ncur_frm.cscript.customer_name = function(doc, cdt, cdn) {\n  if(doc.customer_name) get_server_fields(\'get_customer_details\', doc.customer_name,\'\', doc, cdt, cdn, 1);\n}\n\n// ============= Customer\'s Contact Person Details =====================================\ncur_frm.cscript.contact_person = function(doc, cdt, cdn) {\n  if(doc.contact_person) {\n    var arg = {\'customer\':doc.customer_name,\'contact_person\':doc.contact_person};\n    get_server_fields(\'get_contact_details\',docstring(arg),\'\',doc, cdt, cdn, 1);\n  }\n}\n\n// TRIGGERS FOR CALCULATIONS\n// =====================================================================================================\n\n// ********************* CURRENCY ******************************\ncur_frm.cscript.currency = function(doc, cdt, cdn) { cur_frm.cscript.price_list_name(doc, cdt, cdn);}\n\n// ******************** PRICE LIST ******************************\ncur_frm.cscript.price_list_name = function(doc, cdt, cdn) {\n  var fname = cur_frm.cscript.fname;\n  if(doc.price_list_name && doc.currency) {\n    $c_obj(make_doclist(doc.doctype, doc.name), \'get_adj_percent\', \'\',\n      function(r, rt) {\n        refresh_field(fname);\n        var doc = locals[cdt][cdn];\n        cur_frm.cscript.recalc(doc,3);    //this is to re-calculate BASIC RATE and AMOUNT on basis of changed REF RATE\n      }\n    );\n  }\n}\n\n// ******************* CONVERSION RATE ***************************\ncur_frm.cscript.conversion_rate = function(doc, cdt, cdn) { cur_frm.cscript.price_list_name(doc, cdt, cdn); }\n\n// ******************** ITEM CODE ******************************** \ncur_frm.fields_dict[cur_frm.cscript.fname].grid.get_field("item_code").get_query = function(doc, cdt, cdn) {\n  return \'SELECT tabItem.name,tabItem.item_name,tabItem.description FROM tabItem WHERE tabItem.is_sales_item="Yes" AND tabItem.is_active = "Yes" AND tabItem.%(key)s LIKE "%s" LIMIT 50\'\n}\n\ncur_frm.cscript.item_code = function(doc, cdt, cdn) {\n  var fname = cur_frm.cscript.fname;\n  var d = locals[cdt][cdn];\n  if (d.item_code) {\n    get_server_fields(\'get_item_details\',d.item_code, fname,doc,cdt,cdn,1);\n  }\n  if(cur_frm.cscript.custom_item_code)cur_frm.cscript.custom_item_code(doc, cdt, cdn);\n}\n\n// *********************** QUANTITY ***************************\ncur_frm.cscript.qty = function(doc, cdt, cdn) { \n  if(cur_frm.cscript.update_income_account){\n    cur_frm.cscript.update_income_account(doc,cdt,cdn);\n  }\n  cur_frm.cscript.recalc(doc, 1); }\n  \n// ************************ DISCOUNT (%) ***********************\ncur_frm.cscript.adj_rate = function(doc, cdt, cdn) { cur_frm.cscript.recalc(doc, 1); }\n\n// *********************** BASIC RATE **************************\ncur_frm.cscript.basic_rate = function(doc, cdt, cdn) { \n  if(cur_frm.cscript.update_income_account) {\n    cur_frm.cscript.update_income_account(doc,cdt,cdn);\n  }\n  cur_frm.cscript.recalc(doc, 2); \n}\n\n// ************************ EXPORT RATE *************************\ncur_frm.cscript.export_rate = function(doc,cdt,cdn) { cur_frm.cscript.recalc(doc, 3);}\n\n// ************* GET OTHER CHARGES BASED ON COMPANY *************\ncur_frm.fields_dict.charge.get_query = function(doc) {\n  return \'SELECT DISTINCT `tabOther Charges`.name FROM `tabOther Charges` WHERE `tabOther Charges`.company = "\'+doc.company+\'" AND `tabOther Charges`.company is not NULL AND `tabOther Charges`.%(key)s LIKE "%s" ORDER BY `tabOther Charges`.name LIMIT 50\';\n}\n\n\n// CALCULATION OF TOTAL AMOUNTS\n// ======================================================================================================== \ncur_frm.cscript.recalc = function(doc, n) {\n  if(!n)n=0;\n  doc = locals[doc.doctype][doc.name];\n  var tname = cur_frm.cscript.tname;\n  var fname = cur_frm.cscript.fname;\n  var sales_team = cur_frm.cscript.sales_team_fname;\n  var other_fname  = cur_frm.cscript.other_fname;\n  \n  if(!flt(doc.conversion_rate)) { doc.conversion_rate = 1; refresh_field(\'conversion_rate\'); }\n\n  if(n > 0) cur_frm.cscript.update_fname_table(doc , tname , fname , n); // updates all values in table (i.e. amount, export amount, net total etc.)\n  \n  if(flt(doc.net_total) > 0) {\n    var cl = getchildren(\'RV Tax Detail\', doc.name, other_fname,doc.doctype);\n    for(var i = 0; i<cl.length; i++){\n      cl[i].total_tax_amount = 0;\n      cl[i].total_amount = 0;\n      cl[i].tax_amount = 0;                    // this is done to calculate other charges\n      cl[i].total = 0;\n      cl[i].item_wise_tax_detail = "";\n      if(in_list([\'On Previous Row Amount\',\'On Previous Row Total\'],cl[i].charge_type) && !cl[i].row_id){\n        alert("Please Enter Row on which amount needs to be calculated for row : "+cl[i].idx);\n        validated = false;\n      }\n    }\n    cur_frm.cscript.calc_other_charges(doc , tname , fname , other_fname); // calculate other charges\n  }\n  cur_frm.cscript.calc_doc_values(doc, cdt, cdn, tname, fname, other_fname); // calculates total amounts\n\n  // ******************* calculate allocated amount of sales person ************************\n  cl = getchildren(\'Sales Team\', doc.name, sales_team);\n  for(var i=0;i<cl.length;i++) {\n    if (cl[i].allocated_percentage) {\n      cl[i].allocated_amount = flt(flt(doc.net_total)*flt(cl[i].allocated_percentage)/100);\n      refresh_field(\'allocated_amount\', cl[i].name, sales_team);\n    }\n  }\n  doc.in_words = \'\';\n  doc.in_words_export = \'\';\n  refresh_many([\'total_discount_rate\',\'total_discount\',\'net_total\',\'total_commission\',\'grand_total\',\'rounded_total\',\'grand_total_export\',\'rounded_total_export\',\'in_words\',\'in_words_export\',\'other_charges\',\'other_charges_total\']);\n  if(cur_frm.cscript.custom_recalc)cur_frm.cscript.custom_recalc(doc);\n}\n\n// ******* Calculation of total amounts of document (item amount + other charges)****************\ncur_frm.cscript.calc_doc_values = function(doc, cdt, cdn, tname, fname, other_fname) {\n  doc = locals[doc.doctype][doc.name];\n  var net_total = 0; var other_charges_total = 0;\n  var cl = getchildren(tname, doc.name, fname);\n  for(var i = 0; i<cl.length; i++){\n    net_total += flt(cl[i].amount);\n  }\n  var d = getchildren(\'RV Tax Detail\', doc.name, other_fname,doc.doctype);\n  for(var j = 0; j<d.length; j++){\n    other_charges_total += flt(d[j].amount);\n  }\n  doc.net_total = flt(net_total);\n  doc.other_charges_total = flt(other_charges_total);\n  doc.grand_total = flt(flt(net_total) + flt(other_charges_total));\n  doc.rounded_total = Math.round(doc.grand_total);\n  doc.grand_total_export = flt(flt(doc.grand_total) / flt(doc.conversion_rate));\n  doc.rounded_total_export = Math.round(doc.grand_total_export);\n  doc.total_commission = flt(flt(net_total) * flt(doc.commission_rate) / 100);\n}\n\n// ******************************* OTHER CHARGES *************************************\ncur_frm.cscript.calc_other_charges = function(doc , tname , fname , other_fname) {\n  doc = locals[doc.doctype][doc.name];\n  // make display area\n  // ------------------\n\n  cur_frm.fields_dict[\'Other Charges Calculation\'].disp_area.innerHTML = \'<b style="padding: 8px 0px;">Calculation Details for Other Charges:</b>\';\n  var cl = getchildren(tname, doc.name, fname);\n  var tax = getchildren(\'RV Tax Detail\', doc.name, other_fname,doc.doctype);\n  // make display table\n  // ------------------\n  var otc = make_table(cur_frm.fields_dict[\'Other Charges Calculation\'].disp_area, cl.length + 1, tax.length + 1, \'90%\',[],{border:\'1px solid #AAA\',padding:\'2px\'});\n  $y(otc,{marginTop:\'8px\'});\n  \n  var tax_desc = {}; var tax_desc_rates = []; var net_total = 0;\n  \n  \n  for(var i=0;i<cl.length;i++) {\n    net_total += flt(flt(cl[i].qty) * flt(cl[i].basic_rate));\n    var prev_total = flt(cl[i].amount);\n    if(cl[i].item_tax_rate)\n      var check_tax = eval(\'var a=\'+cl[i].item_tax_rate+\';a\');        //to get in dictionary\n    \n    // Add Item Code in new Row \n    //--------------------------\n    $td(otc,i+1,0).innerHTML = cl[i].item_code;\n    \n    var tax = getchildren(\'RV Tax Detail\', doc.name, other_fname,doc.doctype);\n    var total = net_total;\n    \n    for(var t=0;t<tax.length;t++){\n     \n      var account = tax[t].account_head;\n      $td(otc,0,t+1).innerHTML = account?account:\'\';\n      //Check For Rate\n      if(cl[i].item_tax_rate && check_tax[account]!=null)  {rate = flt(check_tax[account]);}\n      else               // if particular item doesn\'t have particular rate it will take other charges rate\n        rate = flt(tax[t].rate);\n      //Check For Rate and get tax amount\n      var tax_amount = cur_frm.cscript.check_charge_type_and_get_tax_amount(doc,tax,t, cl[i], rate);\n      \n      //enter item_wise_tax_detail i.e. tax rate on each item\n      \n      item_wise_tax_detail = cur_frm.cscript.get_item_wise_tax_detail( doc, rate, cl, i, tax, t);\n      \n      // this is calculation part for all types\n      if(tax[t].charge_type != "Actual") tax[t].item_wise_tax_detail += item_wise_tax_detail;\n      tax[t].total_amount = flt(tax_amount.toFixed(2));     //stores actual tax amount in virtual field\n      tax[t].total_tax_amount = flt(prev_total.toFixed(2));      //stores total amount in virtual field\n      tax[t].tax_amount += flt(tax_amount.toFixed(2));       \n      var total_amount = flt(tax[t].tax_amount);\n      total_tax_amount = flt(tax[t].total_tax_amount) + flt(total_amount);\n      set_multiple(\'RV Tax Detail\', tax[t].name, { \'item_wise_tax_detail\':tax[t].item_wise_tax_detail, \'amount\':total_amount, \'total\':flt(total)+flt(tax[t].tax_amount)/*_tax_amount)*/}, other_fname);\n      prev_total += flt(tax[t].total_amount);   // for previous row total\n      total += flt(tax[t].tax_amount);     // for adding total to previous amount\n      \n      if(tax[t].charge_type == \'Actual\')\n        $td(otc,i+1,t+1).innerHTML = fmt_money(tax[t].total_amount);\n      else\n        $td(otc,i+1,t+1).innerHTML = \'(\'+fmt_money(rate) + \'%) \' +fmt_money(tax[t].total_amount);\n      \n    }\n  }\n}\ncur_frm.cscript.check_charge_type_and_get_tax_amount = function( doc, tax, t, cl, rate, print_amt) {\n  doc = locals[doc.doctype][doc.name];\n  if (! print_amt) print_amt = 0;\n  var tax_amount = 0;\n  if(tax[t].charge_type == \'Actual\') {\n    var value = flt(tax[t].rate) / flt(doc.net_total);   // this give the ratio in which all items are divided           \n    return tax_amount = flt(value) * flt(cl.amount);\n   }   \n  else if(tax[t].charge_type == \'On Net Total\') {\n    if (flt(print_amt) == 1) {\n      doc.excise_rate = flt(rate);\n      doc.total_excise_rate += flt(rate);\n      refresh_field(\'excise_rate\');\n      refresh_field(\'total_excise_rate\');\n      return\n    }\n    return tax_amount = (flt(rate) * flt(cl.amount) / 100);\n  }\n  else if(tax[t].charge_type == \'On Previous Row Amount\'){\n    if(flt(print_amt) == 1) {\n      doc.total_excise_rate += flt(flt(doc.excise_rate) * 0.01 * flt(rate));\n      refresh_field(\'total_excise_rate\');\n      return\n    }\n    var row_no = (tax[t].row_id).toString();\n    var row = (row_no).split("+");      // splits the values and stores in an array\n    for(var r = 0;r<row.length;r++){\n      var id = cint(row[r].replace(/^\\s+|\\s+$/g,""));\n      tax_amount += (flt(rate) * flt(tax[id-1].total_amount) / 100);\n    }\n    var row_id = row_no.indexOf("/");\n    if(row_id != -1) {\n      rate = \'\';\n      var row = (row_no).split("/");      // splits the values and stores in an array\n      if(row.length>2) alert("You cannot enter more than 2 nos. for division");\n      var id1 = cint(row[0].replace(/^\\s+|\\s+$/g,""));\n      var id2 = cint(row[1].replace(/^\\s+|\\s+$/g,""));\n      tax_amount = flt(tax[id1-1].total_amount) / flt(tax[id2-1].total_amount);\n    }\n    return tax_amount\n  }\n  else if(tax[t].charge_type == \'On Previous Row Total\') {\n    if(flt(print_amt) == 1) {\n      doc.sales_tax_rate += flt(rate);\n      refresh_field(\'sales_tax_rate\');\n      return\n    }\n    var row = cint(tax[t].row_id);\n    return tax_amount = flt(rate) * (flt(tax[row-1].total_tax_amount)+flt(tax[row-1].total_amount)) / 100;\n  }\n}\n\n// ********************** Update values in table ******************************\ncur_frm.cscript.update_fname_table = function(doc , tname , fname , n) {\n  doc = locals[doc.doctype][doc.name] \n  var net_total = 0\n  var cl = getchildren(tname, doc.name, fname);\n  for(var i=0;i<cl.length;i++) {\n    if(n == 1){\n      if(flt(cl[i].ref_rate) > 0)\n        set_multiple(tname, cl[i].name, {\'basic_rate\': flt(flt(cl[i].ref_rate) * (100 - flt(cl[i].adj_rate)) / 100)}, fname);\n      set_multiple(tname, cl[i].name, {\'amount\': flt(flt(cl[i].qty) * flt(cl[i].basic_rate)), \'export_rate\': flt(flt(cl[i].basic_rate) / flt(doc.conversion_rate)), \'export_amount\': flt((flt(cl[i].basic_rate) / flt(doc.conversion_rate)) * flt(cl[i].qty)) }, fname);\n    }\n    else if(n == 2){\n      if(flt(cl[i].ref_rate) > 0)\n        set_multiple(tname, cl[i].name, {\'adj_rate\': 100 - flt(flt(cl[i].basic_rate)  * 100 / flt(cl[i].ref_rate))}, fname);\n      set_multiple(tname, cl[i].name, {\'amount\': flt(flt(cl[i].qty) * flt(cl[i].basic_rate)), \'export_rate\': flt(flt(cl[i].basic_rate) / flt(doc.conversion_rate)), \'export_amount\': flt((flt(cl[i].basic_rate) / flt(doc.conversion_rate)) * flt(cl[i].qty)) }, fname);\n    }\n    else if(n == 3){\n      set_multiple(tname, cl[i].name, {\'basic_rate\': flt(flt(cl[i].export_rate) * flt(doc.conversion_rate)) }, fname);\n      set_multiple(tname, cl[i].name, {\'amount\' : flt(flt(cl[i].basic_rate) * flt(cl[i].qty)), \'export_amount\': flt((flt(cl[i].basic_rate) / flt(doc.conversion_rate)) * flt(cl[i].qty))}, fname);\n      if(cl[i].ref_rate > 0)\n        set_multiple(tname, cl[i].name, {\'adj_rate\': 100 - flt(flt(cl[i].basic_rate) * 100 / flt(cl[i].ref_rate))}, fname);\n    }\n    net_total += flt(flt(cl[i].qty) * flt(cl[i].basic_rate));\n  }\n  doc.net_total = net_total;\n  refresh_field(\'net_total\');\n}\n\ncur_frm.cscript.get_item_wise_tax_detail = function( doc, rate, cl, i, tax, t) {\n  doc = locals[doc.doctype][doc.name];\n  var detail = \'\';\n  detail = cl[i].item_code + " : " + cstr(rate) + NEWLINE;\n  return detail;\n}\n\n// **************** RE-CALCULATE VALUES ***************************\n\ncur_frm.cscript[\'Re-Calculate Values\'] = function(doc, cdt, cdn) {\n  cur_frm.cscript[\'Calculate Charges\'](doc,cdt,cdn);\n}\n\ncur_frm.cscript[\'Calculate Charges\'] = function(doc, cdt, cdn) {\n  var other_fname  = cur_frm.cscript.other_fname;\n\n  var cl = getchildren(\'RV Tax Detail\', doc.name, other_fname, doc.doctype);\n  for(var i = 0; i<cl.length; i++){\n    cl[i].total_tax_amount = 0;\n    cl[i].total_amount = 0;\n    cl[i].tax_amount = 0;                    // this is done to calculate other charges\n    cl[i].total = 0;\n    if(in_list([\'On Previous Row Amount\',\'On Previous Row Total\'],cl[i].charge_type) && !cl[i].row_id){\n      alert("Please Enter Row on which amount needs to be calculated for row : "+cl[i].idx);\n      validated = false;\n    }\n  }\n  cur_frm.cscript.recalc(doc, 1);\n}\n\n// Get Sales Partner Commission\n// =================================================================================\ncur_frm.cscript.sales_partner = function(doc, cdt, cdn){\n  if(doc.sales_partner){\n    get_server_fields(\'get_comm_rate\', doc.sales_partner, \'\', doc, cdt, cdn, 1);\n  }\n}\n\n// *******Commission Rate Trigger (calculates total commission amount)*********\ncur_frm.cscript.commission_rate = function(doc, cdt, cdn) {\n  doc.total_commission = doc.net_total * doc.commission_rate / 100;\n  refresh_field(\'total_commission\');\n}\n\n// Sales Person Allocated % trigger \n// ==============================================================================\ncur_frm.cscript.allocated_percentage = function(doc, cdt, cdn) {\n  var fname = cur_frm.cscript.sales_team_fname;\n  var d = locals[cdt][cdn];\n  if (d.allocated_percentage) {\n    d.allocated_amount = flt(flt(doc.net_total)*flt(d.allocated_percentage)/100);\n    refresh_field(\'allocated_amount\', d.name, fname);\n  }\n}\n\n// Client Side Validation\n// =================================================================================\ncur_frm.cscript.validate = function(doc, cdt, cdn) {\n  cur_frm.cscript.validate_items(doc);\n  var cl = getchildren(\'Other Charges\', doc.name, \'other_charges\');\n  for(var i =0;i<cl.length;i++) {\n    if(!cl[i].amount) {\n      alert("Please Enter Amount in Row no. "+cl[i].idx+" in Other Charges table");\n      validated = false;\n    }\n  }\n  cur_frm.cscript[\'Calculate Charges\'] (doc, cdt, cdn);\n  if (cur_frm.cscript.calc_adjustment_amount) cur_frm.cscript.calc_adjustment_amount(doc);\n}\n\n\n// ************** Atleast one item in document ****************\ncur_frm.cscript.validate_items = function(doc) {\n  var cl = getchildren(cur_frm.cscript.tname, doc.name, cur_frm.cscript.fname);\n  if(!cl.length){\n    alert("Please enter Items for " + doc.doctype);\n    validated = false;\n  }\n}',
 'client_string': None,
 'colour': 'White:FFF',
 'creation': '2009-03-23 15:25:08',
 'description': None,
 'docstatus': 0,
 'doctype': 'DocType',
 'dt_template': None,
 'hide_heading': None,
 'hide_toolbar': None,
 'idx': None,
 'in_create': None,
 'is_transaction_doc': None,
 'issingle': 1,
 'istable': None,
 'max_attachments': None,
 'menu_index': None,
 'modified': '2010-08-30 12:32:42',
 'modified_by': 'mohideen@janakhealthcare.com',
 'module': 'CRM',
 'name': 'Sales Common',
 'name_case': '',
 'owner': 'Administrator',
 'parent': None,
 'parent_node': None,
 'parentfield': None,
 'parenttype': None,
 'print_outline': '',
 'read_only': None,
 'search_fields': None,
 'section_style': 'Simple',
 'show_in_menu': 0,
 'smallicon': '',
 'use_template': None,
 'version': 51}
'\n'
'_______________________________________________________'
